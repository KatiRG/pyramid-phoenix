[supervisor_build]

parts =
      supervisor_debian
      supervisor_redhat
      supervisor_config
      supervisor_deploy

[supervisor_debian]
recipe = collective.recipe.cmd
on_install = true
cmds =
    if [ -f /etc/debian_version ] ; then
        sudo apt-get -y --force-yes install supervisor
    fi

[supervisor_redhat]
recipe = collective.recipe.cmd
on_install = true
cmds =
    if [ -f /etc/redhat-release ] ; then
        sudo yum -y install supervisor
    fi

[supervisor_config]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/supervisord.conf.in
output = ${buildout:parts-directory}/supervisor/supervisord.conf

[supervisor_deploy]
recipe = collective.recipe.cmd
on_install = true
on_update = true
cmds =
     sudo cp ${supervisor_config:output} /etc/supervisor/supervisord.conf
     sudo supervisorctl reload           
