[ipython_build]

parts =
    ipython_conda
    ipython_phoenix
    ipython_config
    ipython_supervisor
    ipython_deploy

[ipython_conda]
recipe = collective.recipe.cmd
on_install = true
on_update = true
cmds =
     unset PYTHONPATH
     sudo /opt/anaconda/bin/conda install --yes \
           ipython \
           ipython-notebook

[ipython_phoenix]
recipe = z3c.recipe.scripts
eggs =
    ipython
    ${phoenix:eggs}
entry-points =
   ipython=IPython:start_ipython
scripts =
   ipython=ipython

[ipython_config]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/ipython_notebook_config.py
output = ${buildout:directory}/etc/ipython_notebook_config.py

[ipython_supervisor]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/supervisor.conf.in
output = ${buildout:parts-directory}/ipython/supervisor.conf

program = ipython
command = ${buildout:bin-directory}/ipython notebook --user=${install:user} --config=${ipython_config:output}
directory =  ${buildout:directory}/docs/notebook
priority = 90
environment =

[ipython_deploy]
recipe = collective.recipe.cmd
on_install = true
on_update = true
cmds =
    mkdir ${ipython_supervisor:directory}
    sudo chgrp -R ${install:group} ${buildout:directory}/docs/notebook
    sudo cp ${buildout:parts-directory}/ipython/supervisor.conf /etc/supervisor/conf.d/ipython_phoenix.conf
