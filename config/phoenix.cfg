[buildout]

parts +=
    phoenix_conda
    phoenix_mongodb
    phoenix
    phoenix_config
    phoenix_gunicorn
    phoenix_supervisor
    phoenix_nginx
    phoenix_nose   

[phoenix_conda]
recipe = birdhousebuilder.recipe.conda
pkgs = 
        gunicorn
        nose 
        lxml
        mako 
        dateutil 
        requests 
        pyyaml
        pygments 
        owslib
        pymongo
        pyopenssl=0.13.1
        pytz

[phoenix_mongodb]
recipe = birdhousebuilder.recipe.mongodb

[phoenix]
recipe = z3c.recipe.scripts
eggs = 
    Phoenix
    owslib
    authomatic
interpreter = python

[phoenix_config]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/phoenix.ini
output = ${buildout:anaconda-home}/etc/phoenix.ini

prefix = ${buildout:anaconda-home}
socket = ${buildout:anaconda-home}/var/run/phoenix.socket
workers = 3

[phoenix_gunicorn]
recipe = zc.recipe.egg
eggs =
    gunicorn
    ${phoenix:eggs}
scripts =
    gunicorn=gunicorn

[phoenix_supervisor]
recipe = birdhousebuilder.recipe.supervisor

program = phoenix
command = ${buildout:bin-directory}/gunicorn --paste ${phoenix_config:output} 

[phoenix_nginx]
recipe = birdhousebuilder.recipe.nginx
input = ${buildout:directory}/templates/nginx.conf
sites = phoenix

proxy-enabled = ${settings:proxy-enabled} 
master = true
superuser-enabled = ${settings:proxy-enabled}
user = ${settings:user}
group = ${settings:group}
socket = ${phoenix_config:socket}
hostname =  ${settings:hostname}
http_port = ${settings:http-port}
esgf_search_url = ${settings:esgf-search-url}
wps_url = http://${settings:hostname}:${settings:wps-port}/wps
wpsoutputs_url = http://${settings:hostname}:8090/wpsoutputs
thredds_url = http://${settings:hostname}:${settings:tomcat-port}/thredds

[phoenix_nose]
recipe = z3c.recipe.scripts
eggs =
    nose
    ${phoenix:eggs}
entry-points =
    nosetests=nose:run_exit
scripts =
    nosetests=nosetests
