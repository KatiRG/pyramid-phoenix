[php_fpm_build]

parts =
    php_fpm_debian
    php_fpm_config
    php_fpm_deploy

[php_fpm_debian]
recipe = collective.recipe.cmd
on_install = true
cmds =
    if [ -f /etc/debian_version ] ; then
        sudo apt-get -y --force-yes install php5-fpm php5-curl
    fi

[php_fpm_config]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/php-fpm-www.conf.in
output = ${buildout:parts-directory}/php-fpm/www.conf

[php_fpm_deploy]
recipe = collective.recipe.cmd
on_install = true
on_update = true
cmds =
    sudo cp ${php_fpm_config:output} /etc/php5/fpm/pool.d/www.conf
    sudo service php5-fpm restart