<div tal:define="name name|field.name;
                  css_class css_class|field.widget.css_class;
                  oid oid|field.oid;
                  style style|field.widget.style;"
      tal:omit-tag="">

  <div class="row">
    <div class="col-xs-10">
      <div class="input-group">
        <span class="input-group-addon">URL</span>
        <input type="text" name="url" value="${cstruct}"
               class="span2 form-control ${css_class or ''}"
               tal:attributes="style style"
               id="${oid}"/>
      </div>
    </div>
    <div class="col-xs-2">
      <div class="btn-group" role="group" aria-label="...">
        <button id="${oid}-cart" 
                type="button" class="btn btn-default">
          <icon class="fa fa-shopping-cart"><icon>
        </button>
        <button id="${oid}-upload" 
                type="button" class="btn btn-default">
          <icon class="fa fa-upload"><icon>
        </button>
      </div>
    </div>
  </div>

  <div id="${oid}-cart-form" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Select item from Cart</h4>
        </div>
        <div class="modal-body">
          <select id="${oid}-cart-select" class="form-control"/>
        </div>
        <div class="modal-footer">
          <button id="${oid}-cart-save" type="button" class="btn btn-success" data-dismiss="modal">Save</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  
  <script type="text/javascript">
    var cartItems = '';
    $.getJSON("/list_cart.json", function(json) {
       $.each(json, function(i, item) {
          cartItems += '<option value=' + item.url + '>' + item.title + '</option>';
       });
    });
    deform.addCallback(
          '${field.oid}',
          function (oid) {
              console.log(oid);
              $("#"+oid+"-cart").click(function(event) {
                   console.log('cart button clicked');
                   $select = $("#"+oid+"-cart-select");    
                   $select.empty();
                   $select.append(cartItems);
                   form = $("#"+oid+"-cart-form");
                   form.modal("show");
             });
             $("#"+oid+"-cart-save").click(function(event) {
                 console.log('dialog closed');
                 // event.preventDefault();
                 var url = $("#"+oid+"-cart-select").find(":selected").val();
                 console.log(url);
                 $("#"+oid).val(url);
            });
          }
    );
   
  </script>
   
</div>
