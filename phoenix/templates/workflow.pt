<metal:block use-macro="main_template">
  
  <div metal:fill-slot="content">

    <legend>
      <h3>${title}</h3>
      <small>${description}</small>
    </legend>  

    <div tal:condition="is_esgsearch">

    <span class="hits">${ctx.hit_count}</span> Datasets found

    <p/>

    <h4>Current Selections</h4>
    <div class="tag-box" >
      <span class="tag" tal:repeat="(facet,item) constraints.iteritems()">
        <div class="tag">${facet}:${item}</div>
        <a class="tag" href="${request.route_url('esgsearch', action='delete', facet=facet, item=item, _query=constraints)}">X</a>
      </span>
    </div>

    <p/>

    <h4>Search Categories</h4>
    <div>
      <span class="tags">
        <a tal:repeat="(facet,counts) ctx.get_facet_options().iteritems()" href="${request.route_url('esgsearch', action='update', facet=facet, item=None, _query=constraints)}">
          ${facet}
        </a>
      </span>
    </div>

    <p/>

    <h4>Category: ${facet}</h4>
    <div tal:condition="facet">
      <span class="tags">
        <a tal:repeat="(item,count) ctx.facet_counts[facet].iteritems()" href="${request.route_url('esgsearch', action='add', facet=facet, item=item, _query=constraints)}">
          ${item} (${count})
        </a>
      </span>
    </div>
    
    <p/>

    </div>

    <tal:form replace="structure form">The form will render here</tal:form>

  </div>
</metal:block>
