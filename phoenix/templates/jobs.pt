<metal:block use-macro="main_template">
  <span  metal:fill-slot="content">
  <div id="content"></div>
<script type="text/javascript">
  var request = new XMLHttpRequest();
  function reload(){
     request.open('post','jobsupdate',true);
     request.send(null);
     request.onreadystatechange = update};

   function update(){
       switch (request.readyState){
          case 4:
             if (request.status != 200) {
               alert("Der Request wurde abgeschlossen, ist aber nicht OK\nFehler:"+request.status);
                           }
             else {
                    var content = request.responseText;
                    // den Inhalt des Requests in das <div> schreiben
                    var selected = document.getElementsByName("selected");
                    var selectedValues = new Array();
                    j=0;
                    for(i=0; i < selected.length;i++){
                        if(selected[i].checked){
                        selectedValues[j] = selected[i].value;
                        j++;}}
                    document.getElementById('content').innerHTML = content;
                    selected = document.getElementsByName("selected");
                    for(j=0; j < selectedValues.length;j++){
                        for(i=0; i < selected.length;i++){
                            console.log(i+" "+j)
                            if(selected[i].value==selectedValues[j]){
                                selected[i].checked = true;
                                break
                            }}
                    }
                    setTimeout("reload()",2000)
                   }
             break;
           default:
             break;
     }};


  reload()
</script>
</span>
</metal:block>
