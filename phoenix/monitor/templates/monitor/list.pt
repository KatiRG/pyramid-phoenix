<metal:block use-macro="main_template">

  <div metal:fill-slot="javascript">
    <script src="${request.static_path('phoenix:static/scripts/monitor.js')}"></script>
  </div>

  <div metal:fill-slot="content">

    <div class="panel panel-default">
      <div class="panel-body">
        <form id="from-contents" method="post"
              action="${request.route_path('monitor', _query=[('status', status)])}">
          <div class="form-group">
            <div class="btn-toolbar">
              <div class="btn-group">
                <a tal:attributes="class 'btn btn-default' if access else 'btn btn-default active'"
                   href="${request.route_path('monitor', _query=[('status', status)])}">
                  My Jobs</a>
                <a tal:attributes="class 'btn btn-default active' if access=='public' else 'btn btn-default'"
                   href="${request.route_path('monitor', _query=[('access', 'public'), ('status', status)])}">
                  Public</a>
                <a tal:attributes="class 'btn btn-default active' if access=='private' else 'btn btn-default'"
                   href="${request.route_path('monitor', _query=[('access', 'private'), ('status', status)])}">
                  Private</a>
                <a tal:condition="request.has_permission('admin')" 
                   tal:attributes="class 'btn btn-default active' if access=='all' else 'btn btn-default'"
                   href="${request.route_path('monitor', _query=[('access', 'all'), ('status', status)])}">
                  All</a>
              </div>
              
              <div class="col-md-2">
                <label class="control-label">
                  <select id="status-select" class="form-control">
                    <option value="${request.route_path('monitor', _query=[('access', access)])}">All</option>
                    <optgroup>
                      <option value="${request.route_path('monitor', _query=[('status', new_status), ('access', access)])}"
                              tal:attributes="selected True if new_status==status else False"
                              tal:repeat="new_status ['ProcessQueued', 'ProcessPaused', 'ProcessSucceeded', 'ProcessFailed', 'ProcessStarted', 'ProcessAccepted']">${new_status}</option>
                    </optgroup>
                  </select>
                  Process Status
                </label>
              </div>
              
              <tal:button tal:repeat="button buttons">
                <button name="${button.name}" type="submit" class="${button.css_class}">
                  ${button.title}
                </button>
              </tal:button>
              
            </div>
          </div>
          
          <div class="panel panel-default">
            <div class="panel-heading">
              <span class="panel-title">
                Job List
                <div class="btn-group pull-right">
                  <a class="btn btn-success btn-xs"
                     rel="tooltip"
                     data-toggle="tooltip"
                     title="Refresh job list"
                     href="${request.route_path('monitor', _query=[('page', page), ('limit', limit), ('status', status), ('access', access)])}">
                    <i class="fa fa-lg fa-refresh"></i>
                  </a>
                </div>
              </span>
            </div>
            <div class="panel-body">
              <table class="table table-condensed table-striped table-hover">
                <tal:rows replace="structure grid" />
              </table>
            </div>
          </div>


          <div tal:define="offset min((page * limit) + 1, count); last min((page + 1) * limit, count)" 
               class="clearfix">
            
            <nav>
              <ul class="pager">
                <li class="" tal:attributes="class '' if page > 0 else 'disabled'">
                  <a href="${request.route_path('monitor', _query=[('page', page-1), ('limit', limit), ('status', status), ('access', access)])}">
                    Previous
                  </a>
                </li>
          
                <li class="" tal:attributes="class '' if last < count else 'disabled'">
                  <a href="${request.route_path('monitor', _query=[('page', page+1), ('limit', limit), ('status', status), ('access', access)])}">
                    Next
                  </a>
                </li>
                <li>
                  <span class="pull-right"> Showing ${offset}-${last} of ${count} </span>
                </li>
              </ul>
              
             
            </nav>
            
            
          </div>

        </form>
      </div>
     
    </div>

  </div>
   
</metal:block>
