worker_processes 4;

#pid         logs/nginx.pid;
#error_log   logs/error.log;
#access_log  logs/access.log;

#worker_rlimit_nofile 20480;

events
{
    use epoll;
    worker_connections 20480;
}

timer_resolution 500ms;


http
{
    include       mime.types;
    default_type  application/octet-stream;

    sendfile           on;
    tcp_nodelay        on;
    keepalive_timeout  65;

    gzip_disable "MSIE [1-6]\.(?!.*SV1)";
    gzip_buffers 16 8k;
    gzip_comp_level  1;
    gzip_min_length  0;
    gzip_types text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;

    #
    # uwsgi/WPS
    #
    server
    {
        listen             ${http-port};
        server_name        localhost;

        charset            utf-8;

        # WPS
        location /
        {
            uwsgi_pass     127.0.0.1:${uwsgi-port};
            include        uwsgi_params;
            uwsgi_param    SCRIPT_NAME /;
            uwsgi_buffering     off;
            uwsgi_read_timeout   5;
        }

        # Outputs
        location /wpsoutputs/
        {
            alias ${wps-outputs-path};
        }
    }
}
